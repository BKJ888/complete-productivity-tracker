<!-- åœ¨ nav-tabs åŠ å…¥æ–°é ç±¤ -->
<div class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('pomodoro')">ğŸ… ç•ªèŒ„å·¥ä½œæ³•</button>
    <button class="nav-tab" onclick="switchTab('daily')">ğŸ“… æ¯æ—¥è¿½è¹¤</button>
    <button class="nav-tab" onclick="switchTab('weekly')">ğŸ“Š é€±é–“åæ€</button>
    <button class="nav-tab" onclick="switchTab('monthly')">ğŸ“ˆ æœˆåº¦å ±å‘Š</button>
    <button class="nav-tab" onclick="switchTab('goals')">ğŸ¯ ç›®æ¨™ç®¡ç†</button>
</div>

<!-- æ–°å¢ï¼šæœˆåº¦å ±å‘Š -->
<div id="monthly-tab" class="tab-content">
    <h2>ğŸ“ˆ æœˆåº¦å ±å‘Š</h2>
    <canvas id="monthlyChart" style="max-height:400px;"></canvas>
    <div id="heatmap" style="margin-top:20px;"></div>
</div>

<!-- æ–°å¢ï¼šç›®æ¨™ç®¡ç† -->
<div id="goals-tab" class="tab-content">
    <h2>ğŸ¯ é•·æœŸç›®æ¨™ç®¡ç†</h2>
    <div style="display:flex;gap:10px;margin-bottom:20px;">
        <input type="text" id="goal-input" placeholder="è¼¸å…¥é•·æœŸç›®æ¨™..." style="flex:2;padding:10px;border-radius:8px;border:1px solid #ccc;">
        <input type="number" id="goal-target" placeholder="ç›®æ¨™æ¬¡æ•¸" style="width:120px;padding:10px;border-radius:8px;border:1px solid #ccc;">
        <button onclick="addGoal()" style="padding:10px 20px;border:none;background:#28a745;color:#fff;border-radius:8px;cursor:pointer;">æ–°å¢</button>
    </div>
    <div id="goal-list"></div>
</div>

<!-- æ·±è‰²æ¨¡å¼åˆ‡æ› -->
<div style="position:fixed;bottom:20px;right:20px;">
    <button onclick="toggleDarkMode()" style="padding:10px 15px;border:none;border-radius:50%;background:#333;color:#fff;cursor:pointer;">ğŸŒ™</button>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ====== æ™ºèƒ½æé†’ / éš¨æ©Ÿé¼“å‹µèª ====== */
const encouragements = ["å¤ªæ£’äº†ï¼ç¹¼çºŒä¿æŒğŸ”¥", "ğŸ’ª ä½ æ­£åœ¨é€²æ­¥", "ğŸ‘ å¾ˆæ£’çš„å …æŒ", "ğŸŒŸ æˆå°±+1", "ğŸš€ å‰é€²ä¸€å°æ­¥"];
function randomEncouragement(){
    return encouragements[Math.floor(Math.random()*encouragements.length)];
}

/* ====== æˆå°±ç³»çµ± (å¾½ç« ) ====== */
function checkAchievements(habitId){
    let totalCount = 0;
    Object.keys(localStorage).forEach(key=>{
        if(key.startsWith("habits_")){
            const data = JSON.parse(localStorage.getItem(key) || '{}');
            if(data[habitId]?.completed) totalCount++;
        }
    });
    if(totalCount === 7) showNotification("ğŸ… ç²å¾—å¾½ç« ï¼šé€£çºŒå®Œæˆ7å¤©ï¼");
    if(totalCount === 30) showNotification("ğŸ–ï¸ ç²å¾—å¾½ç« ï¼š30æ¬¡å …æŒé”æˆï¼");
}

/* ====== ä»»å‹™æ¨™ç±¤èˆ‡å„ªå…ˆç´š ====== */
const priorityLevels = ["æœ€ä½", "ä½", "ä¸­", "é«˜", "æœ€é«˜"];
function addTask(){
    const taskText = document.getElementById('task-input').value.trim();
    if(!taskText) return;

    const tag = prompt("è¼¸å…¥ä»»å‹™æ¨™ç±¤ (å¯ç•™ç©º):") || "";
    const priority = prompt("è¼¸å…¥å„ªå…ˆç´š (1æœ€ä½ ~ 5æœ€é«˜):", "3");

    const newTask = {
        id: Date.now(),
        task: taskText,
        tag: tag,
        priority: parseInt(priority),
        startTime: '',
        endTime: '',
        completed: false,
        notes: '',
        date: new Date().toLocaleDateString()
    };
    sessions.push(newTask);
    document.getElementById('task-input').value = '';
    updateTaskDisplay();
}

/* ä¿®æ”¹ updateTaskDisplayï¼ŒåŠ ä¸Šæ¨™ç±¤èˆ‡å„ªå…ˆç´šé¡¯ç¤º */
function updateTaskDisplay(){
    const taskList = document.getElementById('task-list');
    if(sessions.length === 0){
        taskList.innerHTML = '<div style="text-align:center;padding:60px;color:#666;">é‚„æ²’æœ‰ä»»å‹™</div>';
        return;
    }
    taskList.innerHTML = sessions.map(session=>`
        <div style="border:2px solid ${currentSession?.id===session.id?'#007bff':'#e0e0e0'};border-radius:15px;padding:15px;margin-bottom:10px;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <strong>${session.task}</strong> <span style="color:#888;">[${session.tag||'ç„¡æ¨™ç±¤'}]</span> 
                    <span style="color:${session.priority>=4?'red':'#666'};">å„ªå…ˆç´š:${priorityLevels[session.priority-1]}</span>
                </div>
                <button onclick="deleteTask(${session.id})" style="background:#dc3545;color:#fff;border:none;padding:5px 10px;border-radius:5px;">ğŸ—‘ï¸</button>
            </div>
        </div>
    `).join('');
}

/* ====== æœˆåº¦å ±å‘Š Chart.js ====== */
function loadMonthlyReport(){
    const ctx = document.getElementById("monthlyChart").getContext("2d");
    let days = [];
    let values = [];
    for(let i=1;i<=30;i++){
        const d = new Date();
        d.setDate(i);
        days.push(i+"æ—¥");
        const key = d.toDateString();
        const habits = JSON.parse(localStorage.getItem(`habits_${key}`) || '{}');
        values.push(Object.values(habits).filter(h=>h.completed).length);
    }
    new Chart(ctx, {
        type:"bar",
        data:{
            labels:days,
            datasets:[{label:"æ¯æ—¥å®Œæˆç¿’æ…£æ•¸",data:values,backgroundColor:"#667eea"}]
        },
        options:{responsive:true}
    });
}

/* ====== é•·æœŸç›®æ¨™ç®¡ç† ====== */
function addGoal(){
    const input=document.getElementById("goal-input");
    const target=document.getElementById("goal-target");
    if(!input.value||!target.value) return alert("è«‹è¼¸å…¥å®Œæ•´ç›®æ¨™èˆ‡æ¬¡æ•¸");
    const goals=JSON.parse(localStorage.getItem("goals")||"[]");
    goals.push({id:Date.now(),name:input.value,target:parseInt(target.value),progress:0});
    localStorage.setItem("goals",JSON.stringify(goals));
    input.value="";target.value="";
    loadGoals();
}
function loadGoals(){
    const goals=JSON.parse(localStorage.getItem("goals")||"[]");
    const list=document.getElementById("goal-list");
    list.innerHTML=goals.map(g=>`
        <div style="margin-bottom:10px;padding:10px;border:1px solid #ccc;border-radius:8px;">
            <strong>${g.name}</strong> (${g.progress}/${g.target})
            <button onclick="updateGoal(${g.id})">+1</button>
        </div>
    `).join("");
}
function updateGoal(id){
    const goals=JSON.parse(localStorage.getItem("goals")||"[]");
    const g=goals.find(x=>x.id===id);
    if(g){g.progress++;if(g.progress>=g.target)showNotification("ğŸ¯ å®Œæˆé•·æœŸç›®æ¨™ï¼š"+g.name);}
    localStorage.setItem("goals",JSON.stringify(goals));
    loadGoals();
}

/* ====== æ·±è‰²æ¨¡å¼ ====== */
function toggleDarkMode(){
    document.body.classList.toggle("dark-mode");
}
</script>

<style>
/* æ·±è‰²æ¨¡å¼æ¨£å¼ */
body.dark-mode{
    background:#121212;
    color:#f1f1f1;
}
body.dark-mode .container{
    background:#1e1e1e;
}
body.dark-mode .header{
    background:linear-gradient(135deg,#444,#222);
}
</style>
